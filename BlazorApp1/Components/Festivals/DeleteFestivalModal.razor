@rendermode InteractiveServer

@inject IRepositoryFestival RepositoryFestival
@inject NavigationManager NavManager

@using BlazorApp1.Repositories.Interfaces
@using BlazorApp1.Entities

<Modal @ref="_modalRef">
	<ModalContent Centered>
		<ModalHeader>
			<ModalTitle>Delete Festival</ModalTitle>
			<CloseButton />
		</ModalHeader>
		<EditForm Model="_festival" OnValidSubmit="HandleSubmit">
			<ModalBody>
				<p>Are you sure you want to delete this festival?</p>
			</ModalBody>
			<ModalFooter>
				<Button Color="Color.Secondary" Clicked="HideModal">Cancel</Button>
				<Button Color="Color.Danger" Type="ButtonType.Submit">Yes</Button>
			</ModalFooter>
		</EditForm>
	</ModalContent>
</Modal>

@code {
	private Modal _modalRef = new();
	private Festival _festival = new();
	[Parameter] public EventCallback OnChange { get; set; }

	public async Task ShowModal(Festival festival)
	{
		_festival = festival;
		await _modalRef.Show();
	}

	private void HideModal()
	{
		_modalRef.Hide();
	}

	private async Task HandleSubmit()
	{
		RepositoryFestival.Delete(_festival);
		await RepositoryFestival.SaveChangesAsync();
		await OnChange.InvokeAsync();
		await _modalRef.Hide();
	}
}
